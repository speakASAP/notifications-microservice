# Nginx Reverse Proxy Configuration for Notifications Microservice
# This configuration is used by nginx-microservice to generate location blocks
# All requests are proxied to the notifications-microservice backend

# Proxy all requests to notifications-microservice
location / {
    set $NOTIFICATIONS_UPSTREAM notifications-microservice-blue;
    proxy_pass http://$NOTIFICATIONS_UPSTREAM:3368;
    include /etc/nginx/includes/common-proxy-settings.conf;
    
    # Fallback to default page on upstream errors (502, 503, 504)
    error_page 502 503 504 = @default_page;
}

# Fallback location for default landing page
location @default_page {
    root /var/www/html;
    try_files /default.html =502;
    add_header Content-Type text/html;
}

# Health check endpoint
location /health {
    set $NOTIFICATIONS_UPSTREAM notifications-microservice-blue;
    proxy_pass http://$NOTIFICATIONS_UPSTREAM:3368/health;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    access_log off;
    limit_req zone=api burst=5 nodelay;
}
